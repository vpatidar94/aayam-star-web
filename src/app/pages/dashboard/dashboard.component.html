<div class="body__bg">
  <org-dashboard-header title="" subTitle="" [showLogout]="true">
  </org-dashboard-header>
  <div class="dashboard__card question px-3 py-3">
    <!-- <h4 class="text-center text-grey">Dashboard</h4> -->
    <div class="d-flex justify-content-center mt-4" *ngIf="loading">
      <span class="spinner-border" role="status" aria-hidden="true"></span>
    </div>
    <div class="mt-2" *ngIf="!loading && data">
      <div class="px-2 py-1 mb-1" *ngIf="data?.lastTestResult">
        <div class="card text-center card__test">
          <div class="card-header">
            <h5 class="card-title mb-1">Last Test Result</h5>
          </div>
          <div class="card-body py-1">
            <div class="d-flex w-100">
              <div class="w-50">
                <p class="card-title card__content__title">Score</p>
                <h3 class="card-text">
                  {{ data?.lastTestResult.score }}/{{
                    data?.lastTestResult?.testId.questions.length
                  }}
                </h3>
              </div>
              <div class="w-50">
                <p class="card-title card__content__title">Points</p>
                <h3 class="card-text" *ngIf="data?.lastTestResult.points">
                  {{ data?.lastTestResult.points ?? "-" }}
                </h3>
                <p class="card-text mb-0" *ngIf="!data?.lastTestResult.points">
                  Points will be disclosed after result declaration.
                </p>
              </div>
            </div>
            <hr />
            <p class="card-title card__content__title">Rank</p>
            <h3 class="card-text" *ngIf="data?.lastTestResult?.rank">
              {{ data?.lastTestResult?.rank }}
            </h3>
            <h6 class="card-text" *ngIf="!data?.lastTestResult?.rank">
              Rank will be disclosed tomorrow.
            </h6>
          </div>
          <div class="card-footer text-muted">
            {{ data?.lastTestResult?.testId?.title }} |
            {{ data?.lastTestResult?.testId?.testDate | date }}
          </div>
        </div>
      </div>

      <div
        class="px-2 py-1 mb-1"
        *ngIf="
          !scoreLoading 
         &&
          scoreReferral
          &&
          scoreReferral.userReferralPoints + scoreReferral.testsPoints > 0
        "
      > 
        <div class="card text-center card__test">
          <div class="card-header position-relative">
            <h5 class="card-title mb-1">Points</h5>
            <span
              class="expand__collapse__icon"
              (click)="isExpandedPoints = !isExpandedPoints"
            >
              <svg
                *ngIf="!isExpandedPoints"
                xmlns="http://www.w3.org/2000/svg"
                height="24"
                viewBox="0 -960 960 960"
                width="24"
                fill="#ffffff"
              >
                <path
                  d="M480-120 300-300l58-58 122 122 122-122 58 58-180 180ZM358-598l-58-58 180-180 180 180-58 58-122-122-122 122Z"
                />
              </svg>
            </span>
          </div>
          <div class="card-body py-1">
            <p class="card-title card__content__title">Total Points</p>
            <!-- *ngIf="data?.lastTestResult?.rank" -->
            <h3 class="card-text" >
              {{
                (
                  scoreReferral.userReferralPoints + scoreReferral.testsPoints
                ).toFixed(2)
              }}
            </h3>
          </div>
          <div class="card-footer text-muted">
            <div class="d-flex w-100">
              <table class="w-100">
                <tr>
                  <td>
                    <p class="text-center mb-0">
                      User Referral Points :
                      <strong>{{ scoreReferral.userReferralPoints }}</strong>
                    </p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="text-center mb-0">
                      Tests Earn Points :
                      <strong>{{ scoreReferral.testsPoints }}</strong>
                    </p>
                  </td>
                </tr>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div class="px-2 py-1">
        <button
          *ngIf="!data?.todaysTestIsAttempted && data?.todaysTest?.id"
          type="button"
          class="ibtn ibtn__primary w-100 mb-3"
          (click)="redirectToInstruction(data.todaysTest.id)"
        >
          Start Today's Test
        </button>
        <p class="text-center" *ngIf="data?.todaysTestIsAttempted">
          You've already attempted for today's test.
        </p>
        <p
          class="text-center"
          *ngIf="!data?.todaysTestIsAttempted && !data?.todaysTest?.id"
        >
          No test in a queue for today. We will back tomorrow with next test.
        </p>
        <div class="d-flex">
          <div class="w-40 pe-1">
            <button
              type="button"
              class="ibtn ibtn__secondary w-100 mb-3"
              (click)="redirectToScheduled()"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                height="24"
                viewBox="0 -960 960 960"
                width="24"
                fill="#ffffff"
              >
                <path
                  d="M200-80q-33 0-56.5-23.5T120-160v-560q0-33 23.5-56.5T200-800h40v-80h80v80h320v-80h80v80h40q33 0 56.5 23.5T840-720v560q0 33-23.5 56.5T760-80H200Zm0-80h560v-400H200v400Zm0-480h560v-80H200v80Zm0 0v-80 80Zm280 240q-17 0-28.5-11.5T440-440q0-17 11.5-28.5T480-480q17 0 28.5 11.5T520-440q0 17-11.5 28.5T480-400Zm-160 0q-17 0-28.5-11.5T280-440q0-17 11.5-28.5T320-480q17 0 28.5 11.5T360-440q0 17-11.5 28.5T320-400Zm320 0q-17 0-28.5-11.5T600-440q0-17 11.5-28.5T640-480q17 0 28.5 11.5T680-440q0 17-11.5 28.5T640-400ZM480-240q-17 0-28.5-11.5T440-280q0-17 11.5-28.5T480-320q17 0 28.5 11.5T520-280q0 17-11.5 28.5T480-240Zm-160 0q-17 0-28.5-11.5T280-280q0-17 11.5-28.5T320-320q17 0 28.5 11.5T360-280q0 17-11.5 28.5T320-240Zm320 0q-17 0-28.5-11.5T600-280q0-17 11.5-28.5T640-320q17 0 28.5 11.5T680-280q0 17-11.5 28.5T640-240Z"
                />
              </svg>
              <span class="ms-1">Test Schedule</span>
            </button>
          </div>
          <div class="w-60 ps-1">
            <button
              type="button"
              class="ibtn ibtn__secondary w-100 mb-3"
              (click)="copyToClipboard()"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                height="24"
                viewBox="0 -960 960 960"
                width="24"
                fill="#ffffff"
              >
                <path
                  d="M720-80q-50 0-85-35t-35-85q0-7 1-14.5t3-13.5L322-392q-17 15-38 23.5t-44 8.5q-50 0-85-35t-35-85q0-50 35-85t85-35q23 0 44 8.5t38 23.5l282-164q-2-6-3-13.5t-1-14.5q0-50 35-85t85-35q50 0 85 35t35 85q0 50-35 85t-85 35q-23 0-44-8.5T638-672L356-508q2 6 3 13.5t1 14.5q0 7-1 14.5t-3 13.5l282 164q17-15 38-23.5t44-8.5q50 0 85 35t35 85q0 50-35 85t-85 35Zm0-640q17 0 28.5-11.5T760-760q0-17-11.5-28.5T720-800q-17 0-28.5 11.5T680-760q0 17 11.5 28.5T720-720ZM240-440q17 0 28.5-11.5T280-480q0-17-11.5-28.5T240-520q-17 0-28.5 11.5T200-480q0 17 11.5 28.5T240-440Zm480 280q17 0 28.5-11.5T760-200q0-17-11.5-28.5T720-240q-17 0-28.5 11.5T680-200q0 17 11.5 28.5T720-160Zm0-600ZM240-480Zm480 280Z"
                />
              </svg>
              <span class="ms-1">Share and Earn Points</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<ng-container *ngIf="isExpandedPoints">
  <div class="dashboard__card dashboard__result px-3 py-3">
    <h4 class="text-center text-grey mt-1">Test Results</h4>
    <svg
      class="close__icon"
      xmlns="http://www.w3.org/2000/svg"
      height="32"
      viewBox="0 -960 960 960"
      width="32"
      (click)="isExpandedPoints = false"
      fill="#777777"
    >
      <path
        d="m336-280 144-144 144 144 56-56-144-144 144-144-56-56-144 144-144-144-56 56 144 144-144 144 56 56ZM480-80q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z"
      />
    </svg>
    <table class="table mt-4">
      <thead class="table-light">
        <tr>
          <th>Test Date</th>
          <th>Score</th>
          <th>Duration</th>
          <th>Rank</th>
          <th>Points</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of scoreReferral.tests">
          <td>{{ item?.dateCreated | date : "mediumDate" }}</td>
          <td>{{ item?.score }}</td>
          <td>{{ item?.duration }}</td>
          <td>{{ item?.rank }}</td>
          <td>{{ item?.points }}</td>
        </tr>
      </tbody>
    </table>
  </div>
</ng-container>
